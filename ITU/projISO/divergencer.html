<!-- Autor: Katerina Fortova (xforto00) -->
<!DOCTYPE html>
<html>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" />
<script type="text/javascript">
/***
* XMLHttpRequest object constructor (for compatibility with various browsers)
*/
var message_id = null;

function createXmlHttpRequestObject() {
var xmlHttp;
try {
  xmlHttp = new XMLHttpRequest(); //should work on all browsers except IE6 or older
} catch (e) {
  try {
    xmlHttp = new ActiveXObject("Microsoft.XMLHttp"); //browser is IE6 or older
  } catch (e) {
    // ignore error
  }
}
if (!xmlHttp) {
  alert ("Error creating the XMLHttpRequest object.");
} else {
  return xmlHttp;
}
}
function uploadData() {
  try {
    var xmlHttp = createXmlHttpRequestObject();//stores XMLHttpRequestObject
    xmlHttp.onreadystatechange = function() {
                if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
                    //alert(xmlHttp.responseText);
                    //const downloaded_data = JSON.parse(xmlHttp.responseText);
                    //alert(downloaded_data);
                  //document.getElementById("profileimage").innerHTML = document.getElementById("profileimage").innerHTML + "<b>" + downloaded_data[i].title + "</b>" + ": " + downloaded_data[i].review;
                }
            }


    var title = "Divergence";
    var user = "katerina_fortova";

    //// put your code here
    xmlHttp.open("POST", "apiReviews.php", true);// create "servant" waiting for message
		xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;"); // create header of request
    xmlHttp.onreadystatechange = downloadData;
    var message = "title=" + title + "&user=" + user + "&review_text=" + document.getElementById("review").value;
    //alert(message);
		xmlHttp.send(message); // sending data to server
  } catch (e) {
    alert(e.toString());
  }
  return false; // to avoid default form submit behavior
}


function downloadData() {
  //// put your code here
  const xmlHttp = createXmlHttpRequestObject();
	xmlHttp.open("GET", "apiReviews.php", true); // create "servant" waiting for message
	xmlHttp.onreadystatechange = function() //process request when it's needed
  {
	   if (xmlHttp.readyState === 4 && xmlHttp.status === 200) //process is completed and http status is OK
     {

          var obj = xmlHttp.responseText;
          //alert(xmlHttp.responseText);
          obj = obj.substring(149, obj.length - 1);
        //  alert(obj)


        var strLines = obj.split("\n");
        for (var i in strLines) {
          if (strLines[i] == "")
          {
            continue;
          }
         //alert(strLines[i]);
         var obj = JSON.parse(strLines[i]);
         if (obj.title != "Divergence")
         {
           continue;
         }
         if (message_id !== null && obj.id <= message_id) // we aren't in the end of chat
            {
							continue;
						}
         document.getElementById("profileimage").innerHTML = document.getElementById("profileimage").innerHTML + "<h4>" + "<a href=" + obj.user + "r.html>" + obj.user+ "</a></h4>" + "<p>" + obj.review + "</p><hr>";
        // alert(obj.title)
        message_id = obj.id;
        //  alert(obj);
}

          //var downloaded_data = JSON.parse(xmlHttp.responseText); // start parse JSON
        //  alert(downloaded_data[title]);


        //  alert(downloaded_data);
          //alert(xmlHttp.responseText);
/*
          for (let i in downloaded_data) // start parse whole array of message
          {
            // parse JSON to well-looking string
						document.getElementById("profileimage").innerHTML = document.getElementById("profileimage").innerHTML + "<b>" + downloaded_data[i].title + "</b>" + ": " + downloaded_data[i].review + "<hr>";
            //  document.getElementById("profileimage").innerHTML = document.getElementById("profileimage").innerHTML + i
					}
*/
        document.getElementById("profileimage").scrollTop = document.getElementById("profileimage").scrollHeight; // show new messages, dont have to scroll
      }
			};

			xmlHttp.send(null);
}
//// put your code here
downloadData();
//setInterval(downloadData, 7000); // periodic repeating every 2 seconds

</script>

<script>

var dislikes = 0;
// fuction for counting dislikes of book
function dislikeCounter()
{
    dislikes += 1;
    document.getElementById("dislikes").innerHTML = dislikes;
};
</script>
<script>
var likes = 2;
// fuction for counting likes of book
function likeCounter()
{
    likes += 1;
    document.getElementById("likes").innerHTML = likes;
};
</script>

  <head>
    <meta charset="iso-8859-2">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="./css/style.css">
  </head>
  <body>

    <header>
      <div class="container">
        <div id="branding">
          <h1><span class="highlight">Ètenáøský klub Loreta</h1>
        </div>
        <nav>
          <ul>
            <li><a href="index.html">Odhlásit u¾ivatele</a></li>
            <li class="current"><a href="book_listr.html">Katalog knih</a></li>
            <li><a href="katerina_fortovar.html">Mùj profil</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <section id="formstyle">
      <div class="container">
        <h1>Divergence</h1>
        <form>
              <button onclick="dislikeCounter()" type="button" class="button_1">Nelíbilo se</button>
        </form>
        <form>
              <button  onclick="likeCounter()" type="button" class="button_1">Líbilo se</button>
        </form>

      </div>
    </section>

    <section id="main">
  <div class="container">
    <div id="bookimage">
    <p><img src="./img/divergence.jpg" alt="Divergence" style="width:230px;margin-right:15px;">
      <p><b>Autor: </b>Veronica Roth</p>
      <p><b>®ánr: </b>Dystopie</p>
      <p><b>Hodnocení: </b>Líbilo se: <a id="likes">2</a>  Nelíbilo se: <a id="dislikes">0</a></p>
      <p> Hlavní hrdinka Beatrice ¾ije v Chicagu budoucnosti, kde je spoleènost rozdìlena do 5 frakcí­ a ka¾dá z nich se vìnuje pìstování urèité ctnosti - Odevzdanost, Neohro¾enost, Seètìlost, Mí­rumilovnost a Upøímnost. Ka¾dý rok ve stanovený den si musí v¹ichni ¹estnáctiletí­ vybrat jednu z frakcí­, do ní¾ budou patøit po celý svùj ¾ivot. Beatrice se rozhoduje mezi tím, jestli zùstane s rodinou, nebo bude sama sebou - obojí mít nemù¾e...</p>
    </p>
    <p><a href="https://www.knihydobrovsky.cz/divergence-83519"><b>Koupit knihu online</b></a></p>
        </div>
    </section>

    <section id="main">
  <div class="container">
    <div id="bookimage">
      <select>
        <option value="read">Pøeèteno</option>
        <option value="toread">Chci si pøeèíst</option>
        <option value="toread">Odebrat z seznamu knih</option>
      </select>
        </div>
    </section>



    <section id="main">
  <div class="container">
 <p><i><h3>Divergence patøí právem k nejètenìj¹ím knihám souèasnosti. Pøíbìh je promy¹len do nejmen¹ích detailù a je plný pøekvapení, tak¾e ètenáø nemá nejmen¹í ¹anci se nudit. Knihu doporuèuji v¹em, kteøí stejnì jako já milují pøíbìhy z budoucnosti rozvíjející fantazii.</i></h3> - <a href="http://www.klubknihomolu.cz/17963/mila-beatrice-jsi-divergentni-ale-nikomu-to-nerikej/">klubknihomolu.cz</a></p>
  </div>
</section>

  <br>


    <section id="main">
  <div class="container">
    <div id="profileimage">

        </div>
      </div>
    </section>

    <section id="main">
  <div class="container">
    <div id="sendreview">
    <form onsubmit="return uploadData()">
      <br><textarea id="review" placeholder="Sem zadejte recenzi..."></textarea><br>
      <input type="submit" class="button_3" value="Odeslat" >
    </form>
    </div>
  </div>
</section>


    <footer>
      <p>Ètenáøský klub Loreta 2019</p>
    </footer>
  </body>
</html>
