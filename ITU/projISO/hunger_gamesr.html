<!-- Autor: Katerina Fortova (xforto00) -->

<!DOCTYPE html>
<html>

<script type="text/javascript">

var message_id = null;

function createXmlHttpRequestObject() {
var xmlHttp;
try {
  xmlHttp = new XMLHttpRequest();
} catch (e) {
  try {
    xmlHttp = new ActiveXObject("Microsoft.XMLHttp");
  } catch (e) {
  }
}
if (!xmlHttp) {
  alert ("Error creating the XMLHttpRequest object.");
} else {
  return xmlHttp;
}
}
function uploadToList() {
  try {
    var xmlHttp = createXmlHttpRequestObject();

    var title = "Hunger Games";
    var user = "katerina_fortova";
    var author = "Suzanne Collins";
    var image = "hungergames2.jpg";
    var page = "hunger_games";

    var booklist_select = document.getElementById("mybooklist");
    var index = booklist_select.selectedIndex;
    var booklist = booklist_select.options[index].value;

    xmlHttp.open("POST", "apiList.php", true);
		xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;");
    var message = "title=" + title + "&page=" + page + "&author=" + author + "&image=" + image + "&user=" + user + "&booklist=" + booklist;
		xmlHttp.send(message);
  } catch (e) {
    alert(e.toString());
  }
  return false;
}
function uploadReview() {
  try {
    var xmlHttp = createXmlHttpRequestObject();

    var title = "Hunger Games";
    var user = "katerina_fortova";

    xmlHttp.open("POST", "apiReviews.php", true);
		xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;");
    xmlHttp.onreadystatechange = downloadReview;
    var message = "title=" + title + "&user=" + user + "&review_text=" + document.getElementById("review").value;
		xmlHttp.send(message);
  } catch (e) {
    alert(e.toString());
  }
  return false;
}


function downloadReview() {
  const xmlHttp = createXmlHttpRequestObject();
	xmlHttp.open("GET", "apiReviews.php", true);
	xmlHttp.onreadystatechange = function()
  {
	   if (xmlHttp.readyState === 4 && xmlHttp.status === 200)
     {
          var obj = xmlHttp.responseText;
          obj = obj.substring(149, obj.length - 1);

          var lines = obj.split("\n");
          for (var i in lines)
          {
            if (lines[i] == "")
            {
              continue;
            }

            var obj = JSON.parse(lines[i]);
            if (obj.title != "Hunger Games")
            {
              continue;
            }
            if (message_id !== null && obj.id <= message_id)
            {
							continue;
				    }
            document.getElementById("profileimage").innerHTML = document.getElementById("profileimage").innerHTML + "<h4>" + "<a href=" + obj.user + "r.html>" + obj.user+ "</a></h4>" + "<p>" + obj.review + "</p><hr>";
            message_id = obj.id;
          }

        document.getElementById("profileimage").scrollTop = document.getElementById("profileimage").scrollHeight;
      }
			};

			xmlHttp.send(null);
}
function uploadLike()
{
  try {
    var xmlHttp = createXmlHttpRequestObject();

    var title = "Hunger Games";

    xmlHttp.open("POST", "apiLikes.php", true);
		xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;");
    xmlHttp.onreadystatechange = downloadLike;
    var message = "title=" + title;
		xmlHttp.send(message);
  } catch (e) {
    alert(e.toString());
  }
  return false;
}
function downloadLike() {
  const xmlHttp = createXmlHttpRequestObject();
	xmlHttp.open("GET", "apiLikes.php", true);
  var sum_likes = 0;
	xmlHttp.onreadystatechange = function()
  {
	   if (xmlHttp.readyState === 4 && xmlHttp.status === 200)
     {
          var obj = xmlHttp.responseText;

          var lines = obj.split("\n");
          for (var i in lines)
          {
            if (lines[i] == "")
            {
              continue;
            }

            var obj = JSON.parse(lines[i]);
            if (obj.title != "Hunger Games")
            {
              continue;
            }

            sum_likes = obj.like + sum_likes;

          }

        document.getElementById("likes").innerHTML = sum_likes;
      }
			};

			xmlHttp.send(null);
}

function uploadDislike()
{
  try {
    var xmlHttp = createXmlHttpRequestObject();

    var title = "Hunger Games";

    xmlHttp.open("POST", "apiDislikes.php", true);
		xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;");
    xmlHttp.onreadystatechange = downloadDislike;
    var message = "title=" + title;
		xmlHttp.send(message);
  } catch (e) {
    alert(e.toString());
  }
  return false;
}
function downloadDislike() {
  const xmlHttp = createXmlHttpRequestObject();
	xmlHttp.open("GET", "apiDislikes.php", true);
  var sum_dislikes = 0;
	xmlHttp.onreadystatechange = function()
  {
	   if (xmlHttp.readyState === 4 && xmlHttp.status === 200)
     {
          var obj = xmlHttp.responseText;

          var lines = obj.split("\n");
          for (var i in lines)
          {
            if (lines[i] == "")
            {
              continue;
            }

            var obj = JSON.parse(lines[i]);
            if (obj.title != "Hunger Games")
            {
              continue;
            }

            sum_dislikes = obj.dislike + sum_dislikes;

          }

        document.getElementById("dislikes").innerHTML = sum_dislikes;
      }
			};

			xmlHttp.send(null);
}

downloadLike();
downloadDislike();
downloadReview();
//setInterval(downloadReview, 7000); // periodic repeating every 2 seconds

</script>


  <head>
    <meta charset="iso-8859-2">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="./css/style.css">
  </head>
  <body>
    <header>
      <div class="container">
        <div id="branding">
          <h1><span class="highlight">Ètenáøský klub Loreta</h1>
        </div>
        <nav>
          <ul>
            <li><a href="index.html">Odhlásit u¾ivatele</a></li>
            <li class="current"><a href="book_listr.html">Katalog knih</a></li>
            <li><a href="katerina_fortovar.html">Mùj profil</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <section id="formstyle">
      <div class="container">
        <h1>Hunger Games</h1>
        <form>
              <button onclick="uploadDislike()" type="button" class="button_1">Nelíbilo se</button>
        </form>
        <form>
              <button  onclick="uploadLike()" type="button" class="button_1">Líbilo se</button>
        </form>

      </div>
    </section>

    <section id="main">
  <div class="container">
    <div id="bookimage">
    <p><img src="./img/hungergames2.jpg" alt="HungerGames" style="width:230px;margin-right:15px;">
      <p><b>Autor: </b>Suzanne Collins</p>
      <p><b>®ánr: </b>Dystopie</p>
      <p><b>Hodnocení: </b>Líbilo se: <a id="likes"></a>  Nelíbilo se: <a id="dislikes"></a></p>
      <p>Dokázali byste pøe¾ít v divoèinì, kde se v¹ichni sna¾í o to, abyste nespatøili dal¹í úsvit? V troskách zemì, kdysi známé jako Severní Amerika, se rozkládá Panem s nablýskaným hlavním mìstem Kapitolem a dvanácti okolními kraji. Kapitol jim vládne krutou a tvrdou rukou a udr¾uje si jejich poslu¹nost tím, ¾e je nutí, aby ka¾dý rok vysílaly jednoho chlapce a jednu dívku ve vìku mezi dvanácti a osmnácti lety jako úèastníky Hladových her - boje na ¾ivot a na smrt pøená¹eného televizí. ©estnáctiletá Katniss Everdeenová, která bydlí sama se svou matkou a mlad¹í sestrou, pova¾uje úèast ve hrách za rozsudek smrti, kdy¿ se nabízí jako dobrovolnice, aby nahradila svou sestru, její¾ jméno bylo vylosováno pro leto¹ní roèník. Katniss se ale u¾ v minulosti ocitla na pokraji smrti - a je odbornicí na pøe¾ití. Ani¾ by chtìla, stává se soutì¾ící.</p>
    </p>
    <p><a href="https://www.knihydobrovsky.cz/hunger-games-arena-smrti-595555"><b>Koupit knihu online</b></a></p>
        </div>
    </section>

    <section id="main">
  <div class="container">
    <div id="bookimage">
      <form onsubmit="return uploadToList()">
      <select id="mybooklist">
        <option value="toread">Chci si pøeèíst</option>
        <option value="read">Pøeèteno</option>
      </select>
      <input type="submit" class="button_3" value="Pøidat" >
      </form>
        </div>
    </section>





    <section id="main">
  <div class="container">
 <p><i><h3>Celkovì Arénu smrti hodnotím jako velmi povedenou kní¾ku. Dokázala mì ¹okovat, ale i dojmout. O to vìt¹í z ní mám zá¾itek, ¾e bìhem ètení jsem mìla pocit, jako bych byla u v¹eho, co hrdinka pro¾ívá. Zaujaly mì také detaily jako zpívající reprodrozdi, mutové nebo gesto tøí prostøedních prstù pøitisknutých ke rtùm a pak vzta¾ených k osobì, se kterou se louèíme. Tyto drobnosti dìlají knihu osobitìj¹í..</i></h3> - <a href="http://www.klubknihomolu.cz/14408/hra-ve-ktere-prohrat-rovna-se-zemrit/">klubknihomolu.cz</a></p>
  </div>
</section>

<br>

<section id="main">
<div class="container">
<div id="profileimage">
    </div>
  </div>
</section>

<section id="main">
<div class="container">
<div id="sendreview">
<form onsubmit="return uploadReview()">
  <br><textarea id="review" placeholder="Sem zadejte recenzi..."></textarea><br>
  <input type="submit" class="button_3" value="Odeslat" >
</form>
</div>
</div>
</section>


    <footer>
      <p>Ètenáøský klub Loreta 2019</p>
    </footer>
  </body>
</html>
